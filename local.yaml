---
- hosts: localhost
  connection: local
  become: false

  tasks:
    # Dock configurations
    - name: Remove Dock autohide delay
      community.general.osx_defaults:
        domain: com.apple.dock
        key: autohide-delay
        type: float
        value: 0

    - name: Speed up Dock autohide animation
      community.general.osx_defaults:
        domain: com.apple.dock
        key: autohide-time-modifier
        type: int
        value: 0

    - name: Add spacer tile to Dock
      ansible.builtin.shell: |
        defaults write com.apple.dock persistent-apps -array-add '{tile-data={}; tile-type="spacer-tile";}'
      args:
        executable: /bin/bash

    - name: Set Dock position to left
      community.general.osx_defaults:
        domain: com.apple.dock
        key: orientation
        type: string
        value: "left"

    - name: Disable Dock minimize/maximize animation
      community.general.osx_defaults:
        domain: com.apple.dock
        key: mineffect
        type: string
        value: "scale"

    - name: Enable auto-hide for the Dock
      community.general.osx_defaults:
        domain: com.apple.dock
        key: autohide
        type: bool
        value: true

    - name: Disable Dock animate opening applications
      community.general.osx_defaults:
        domain: com.apple.dock
        key: launchanim
        type: bool
        value: false

    - name: Disable Dock show recent applications
      community.general.osx_defaults:
        domain: com.apple.dock
        key: show-recents
        type: bool
        value: false

    - name: Restart Dock to apply changes
      ansible.builtin.command: killall Dock

    # Finder configurations
    - name: Show all filename extensions in Finder
      community.general.osx_defaults:
        domain: NSGlobalDomain
        key: AppleShowAllExtensions
        type: bool
        value: true

    - name: Remove Tags from Finder sidebar
      community.general.osx_defaults:
        domain: com.apple.finder
        key: ShowRecentTags
        type: bool
        value: false

    - name: Hide Recents from Finder sidebar
      community.general.osx_defaults:
        domain: com.apple.finder
        key: FXPreferredGroupBy
        type: string
        value: "None"

    - name: Show full POSIX path in Finder window title
      community.general.osx_defaults:
        domain: com.apple.finder
        key: _FXShowPosixPathInTitle
        type: bool
        value: true

    - name: Show Finder status bar
      community.general.osx_defaults:
        domain: com.apple.finder
        key: ShowStatusBar
        type: bool
        value: true

    # Save screenshots to Downloads folder
    - name: Set screenshots location to Downloads
      community.general.osx_defaults:
        domain: com.apple.screencapture
        key: location
        type: string
        value: "{{ ansible_env.HOME }}/Downloads"

    # Set screenshots format to JPG
    - name: Set screenshots format to JPG
      community.general.osx_defaults:
        domain: com.apple.screencapture
        key: type
        type: string
        value: "jpg"

    # Avoid creating .DS_Store files on network volumes
    - name: Prevent .DS_Store files on network volumes
      community.general.osx_defaults:
        domain: com.apple.desktopservices
        key: DSDontWriteNetworkStores
        type: bool
        value: true

    # Speed up Mission Control animations
    - name: Speed up Mission Control animation duration
      community.general.osx_defaults:
        domain: com.apple.dock
        key: expose-animation-duration
        type: float
        value: 0.15

    # Set Home directory as the default location for new Finder windows
    - name: Set Home directory as default location for new Finder windows
      community.general.osx_defaults:
        domain: com.apple.finder
        key: NewWindowTarget
        type: string
        value: "PfLo"  # "PfLo" sets it to "Other..." for custom paths

    - name: Set Home directory path for new Finder windows
      community.general.osx_defaults:
        domain: com.apple.finder
        key: NewWindowTargetPath
        type: string
        value: "file://{{ ansible_env.HOME }}/"

    # Restart Finder to apply changes
    - name: Restart Finder to apply changes
      ansible.builtin.command: killall Finder
